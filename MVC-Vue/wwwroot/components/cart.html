<v-container>
    <v-row>
        <v-col cols="12" md="8">
            <v-row align="center" class="mb-4">
                <v-col cols="auto">
                    <v-btn icon="mdi-arrow-left" variant="text" @click="goBack"></v-btn>
                </v-col>

                <v-col>
                    <h1 class="text-h4 title">Giỏ hàng của bạn</h1>
                </v-col>
            </v-row>

            <v-card v-if="cartItems.length === 0" class="pa-5 text-center">
                <v-card-text>
                    Giỏ hàng của bạn đang trống.
                </v-card-text>
                <v-btn color="primary" @click="goBack">Tiếp tục mua sắm</v-btn>
            </v-card>

            <v-card v-else class="mb-4">
                <v-list lines="two">
                    <v-list-item v-for="(item, index) in cartItems" :key="index" class="py-4">
                        <v-row align="center">
                            <v-col cols="4" sm="3">
                                <div class="position-relative">
                                    <v-img :src="item.image"  cover class="rounded"></v-img>
                                    <div v-if="item.discount > 0" class="discount-badge-small">
                                        -{{ item.discount }}%
                                    </div>
                                </div>
                            </v-col>

                            <v-col cols="8" sm="5" class="d-flex flex-column justify-center">
                                <v-list-item-subtitle class=" mb-1">
                                    SKU: {{ item.sku }}
                                </v-list-item-subtitle>
                                <v-list-item-title class="font-weight-bold text-wrap mb-1">
                                    {{ item.name }}
                                </v-list-item-title>
                                <v-list-item-subtitle class="mb-2">
                                    Màu: {{ item.color }} / Size: {{ item.size }}
                                </v-list-item-subtitle>

                                <div class="text-body-2 mb-1">
                                    <span v-if="item.discount > 0" class="text-decoration-line-through text-grey me-2">
                                        {{ $formatCurrency(item.price) }}
                                    </span>
                                    <span class="font-weight-bold">
                                        {{ $formatCurrency(calculateDiscountedPrice(item)) }}
                                    </span>
                                </div>
                            </v-col>

                            <v-col cols="12" sm="4" class="text-right d-flex align-center justify-end">
                                <v-text-field v-model.number="item.quantity" type="number" min="1" density="compact"
                                    variant="outlined" hide-details style="max-width: 80px;"
                                    class="me-3"></v-text-field>
                                <v-btn icon="mdi-delete" variant="text" color="red" @click="removeItem(item)"></v-btn>
                            </v-col>
                        </v-row>
                        <v-divider v-if="index < cartItems.length - 1" class="mt-4"></v-divider>
                    </v-list-item>
                </v-list>
            </v-card>
        </v-col>

        <v-col cols="12" md="4">
            <v-card class="sticky-card">
                <v-card-title class="text-h6">Tóm tắt đơn hàng</v-card-title>
                <v-divider></v-divider>
                <v-card-text>
                    <v-row dense class="mb-2">
                        <v-col>Tạm tính</v-col>
                        <v-col class="text-right font-weight-medium">
                            {{ $formatCurrency(subtotal) }}
                        </v-col>
                    </v-row>

                    <v-row dense class="mb-2 text-success" v-if="totalSavings > 0">
                        <v-col>Bạn tiết kiệm</v-col>
                        <v-col class="text-right font-weight-medium">
                            - {{ $formatCurrency(totalSavings) }}
                        </v-col>
                    </v-row>

                    <v-row dense class="mb-2">
                        <v-col>Phí vận chuyển</v-col>
                        <v-col class="text-right font-weight-medium">
                            {{ $formatCurrency(shipping) }}
                        </v-col>
                    </v-row>

                    <v-row dense>
                        <v-col>Thuế (10%)</v-col>
                        <v-col class="text-right font-weight-medium">
                            {{ $formatCurrency(tax) }}
                        </v-col>
                    </v-row>

                    <v-divider class="my-3"></v-divider>

                    <v-row dense class="text-h6">
                        <v-col>Tổng cộng</v-col>
                        <v-col class="text-right">
                            {{ $formatCurrency(total) }}
                        </v-col>
                    </v-row>
                </v-card-text>

                <v-card-actions class="pa-4">
                    <v-btn block color="primary" size="large" @click="checkout">
                        Thanh toán
                    </v-btn>
                </v-card-actions>
            </v-card>
        </v-col>
    </v-row>
</v-container>